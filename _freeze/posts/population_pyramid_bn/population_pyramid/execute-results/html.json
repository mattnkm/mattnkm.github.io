{
  "hash": "fea2e27a7065c52cabab7948a0121d99",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"bruneians by age and resident status\"\ndescription: \"hellow\"\nauthor: \"Matthew Ng\"\ntype: default\ndate: \"2024-05-14\"\ncategories: [brunei, statistics]\nformat:\n  html:\n    code-fold: true\n    code-summary: \"show code\"\n---\n\n\n### libraries\n\nMain libraries in code block.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(librarian)\nshelf(readxl, tidyverse, reshape2)\n```\n:::\n\n\n# introduction\n\nLast week, I found myself back in Brunei—not for the usual family visit, but for work and to give a talk on data science.\n\nIt was a real blink-and-you-miss-it trip; barely three days on the ground.\n\nIn true Bruneian fashion, we filled the time between meetings and talks by dining out. I think it was by our fourth restaurant visit that my colleague Thomas—a Kiwi and a first-timer in Brunei—asked in the most hilariously earnest way: \"why aren't there any locals running their own businesses?\"\n\nTo be honest, I was stumped. I knew we had a population of more or less half a million, but that was really the limit of what I could offer.\n\n# data\n\nThat was the inspiration for this post. I managed to collate and convert the terrible `.pdf` from the Department of Statistics into some usable tables.\n\nThinking if anyone stumbled upon this blog, they'd maybe want to recreate this.\n\nThe main data sets I collated from the table is the age group by nationality table (`BN_age_group_nationality.xlsx` in this post's repo) from the published 2021 national census.\n\nThe main data structure is pretty simple:\n\n1.  `age_group`: Mostly at 5-year division, top-coded at 85+\n2.  `type`: categorical options at total, bruneian, permanent_resident, and temporary_resident\n3.  `male`: total number of males\n4.  `female`: total number of females\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# main data structure\nread_xlsx(\"BN_age_group_nationality.xlsx\") %>% \n  str()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\ntibble [72 × 4] (S3: tbl_df/tbl/data.frame)\n $ age_group: chr [1:72] \"00-04\" \"05-09\" \"10-14\" \"15-19\" ...\n $ type     : chr [1:72] \"total\" \"total\" \"total\" \"total\" ...\n $ male     : num [1:72] 14258 16658 16051 17365 19870 ...\n $ female   : num [1:72] 13097 15276 15036 16425 17229 ...\n```\n\n\n:::\n:::\n\n\n## processing\n\nThe only real processing we need to do is to get the lower age limit for each of the age groups within the data set. That's relatively simple with the following code:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# read as age_group object\nage_group <- read_xlsx(\"BN_age_group_nationality.xlsx\")\n\n# get first two characters from column\nage_group <- age_group %>%\n  mutate(lower_age = substr(age_group, 1, 2)) %>% \n  # reposition to second column\n  relocate(lower_age, .before = age_group)\n\n# final dataset\nage_group\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 72 × 5\n   lower_age age_group type   male female\n   <chr>     <chr>     <chr> <dbl>  <dbl>\n 1 00        00-04     total 14258  13097\n 2 05        05-09     total 16658  15276\n 3 10        10-14     total 16051  15036\n 4 15        15-19     total 17365  16425\n 5 20        20-24     total 19870  17229\n 6 25        25-29     total 22698  18408\n 7 30        30-34     total 22630  17904\n 8 35        35-39     total 21289  17136\n 9 40        40-44     total 19231  16232\n10 45        45-49     total 16463  15079\n# ℹ 62 more rows\n```\n\n\n:::\n:::\n\n\n# pyramids\n\nTo get a better sense of our population in 2021, we'll make 3 pyramids for the total by age group, a facet by nationality, and a per capita by nationality graph.\n\n## population by age group\nIn the grand scheme of things, men outnumber women in Brunei by around 11.4%. What I find particularly interesting is the odd bulge at around 20-45 for men. At this subset, men outnumbered women by an average of about 21.5%, compared to the overall difference per age group of around 4.6%, which suggests an external mechanism.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# total population by age group\nage_group %>%\n  filter(type == \"total\") %>% \n  # melt for male and female\n  melt(value.name = \"total\",\n       variable.name = \"gender\") %>%\n  # plot\n  ggplot(aes(fill = gender, \n             x = lower_age, \n             y = ifelse(\n               test = gender == \"male\",\n               # flip the values to the negative\n               yes = -total,\n               no = total),\n             )) +\n         geom_col(alpha = 0.9) +\n  # flip the y-axis\n  coord_flip() +\n  scale_y_continuous(\n    labels = abs, # set as absolute to remove negative sign\n    limits = c(-25000, 25000) # set limits aesthetics\n    ) +\n  labs(\n    x = \"total\",\n    y = \"age group\",\n    title = \"population by age group\"\n  ) + # change color with brewer\n  scale_fill_brewer(palette = \"Set1\") +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](population_pyramid_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n\n## age groups by nationality\n\n::: {.cell}\n\n```{.r .cell-code}\n# total population by age group\nage_group %>%\n  #filter out total\n  filter(type != \"total\") %>%\n  # melt for male and female\n  melt(value.name = \"total\",\n       variable.name = \"gender\") %>%\n  # plot\n  ggplot(aes(fill = gender, \n             x = lower_age, \n             y = ifelse(\n               test = gender == \"male\",\n               # flip the values to the negative\n               yes = -total,\n               no = total),\n             )) +\n         geom_col(alpha = 0.9) +\n  # flip the y-axis\n  coord_flip() +\n  scale_y_continuous(\n    labels = abs, # set as absolute to remove negative sign\n    # limits = c(-30000, 30000) # set limits aesthetics\n    ) +\n  labs(\n    x = \"total\",\n    y = \"age group\",\n    title = \"population by age group\"\n  ) + # change color with brewer\n  scale_fill_brewer(palette = \"Set1\") +\n  facet_wrap(~type) +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](population_pyramid_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n\n## per capita by nationality\n",
    "supporting": [
      "population_pyramid_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}