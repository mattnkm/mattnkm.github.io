{
  "hash": "2d9dd969e7d187760186c33ac4e323d0",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"bruneians by age and resident status\"\ndescription: \"hellow\"\nauthor: \"Matthew Ng\"\ntype: default\ndate: \"2024-05-14\"\ncategories: [brunei, statistics]\nformat:\n  html:\n    code-fold: true\n    code-summary: \"show code\"\n---\n\n\n### libraries\n\nMain libraries in code block.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(librarian)\nshelf(readxl, tidyverse, reshape2)\n```\n:::\n\n\n# introduction\n\nLast week, I found myself back in Brunei—not for the usual family visit, but for a bunch of work meetings and to give a talk on data science.\n\nIt was a real blink-and-you-miss-it trip; barely three days on the ground.\n\nIn true Bruneian fashion, we filled the time between meetings and talks by dining out. I think it was by our fourth restaurant visit that my colleague Thomas—a Kiwi and a first-timer in Brunei—asked in the most hilariously earnest way: \"why aren't there any locals running their own businesses?\"\n\nTo be honest, I didn't know --- I spent most of my first 18 years there, and it had always really been this . I mean  knew we had a population of more or less half a million, but that was really the limit of what I could offer him.\n\n# data\n\nThat was the inspiration for this post.\n\nI managed to collate and convert the terrible `.pdf` from the Department of Statistics into some usable tables.\n\nThinking if anyone stumbled upon this blog, they'd maybe want to recreate this.\n\nThe main data sets I collated from the table is the age group by nationality table (`BN_age_group_nationality.xlsx` in this post's repo) from the published 2021 national census.\n\nThe main data structure is pretty simple:\n\n1.  `age_group`: Mostly at 5-year division, top-coded at 85+\n2.  `type`: categorical options at total, bruneian, permanent_resident, and temporary_resident\n3.  `male`: total number of males\n4.  `female`: total number of females\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# main data structure\nread_xlsx(\"BN_age_group_nationality.xlsx\") %>% \n  str()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\ntibble [72 × 4] (S3: tbl_df/tbl/data.frame)\n $ age_group: chr [1:72] \"00-04\" \"05-09\" \"10-14\" \"15-19\" ...\n $ type     : chr [1:72] \"total\" \"total\" \"total\" \"total\" ...\n $ male     : num [1:72] 14258 16658 16051 17365 19870 ...\n $ female   : num [1:72] 13097 15276 15036 16425 17229 ...\n```\n\n\n:::\n:::\n\n\n## processing\n\nThe only real processing we need to do is to get the lower age limit for each of the age groups within the data set. That's relatively simple with the following code:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# read as age_group object\nage_group <- read_xlsx(\"BN_age_group_nationality.xlsx\")\n\n# get first two characters from column\nage_group <- age_group %>%\n  mutate(lower_age = substr(age_group, 1, 2)) %>% \n  # reposition to second column\n  relocate(lower_age, .before = age_group)\n\n# final dataset\nage_group\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 72 × 5\n   lower_age age_group type   male female\n   <chr>     <chr>     <chr> <dbl>  <dbl>\n 1 00        00-04     total 14258  13097\n 2 05        05-09     total 16658  15276\n 3 10        10-14     total 16051  15036\n 4 15        15-19     total 17365  16425\n 5 20        20-24     total 19870  17229\n 6 25        25-29     total 22698  18408\n 7 30        30-34     total 22630  17904\n 8 35        35-39     total 21289  17136\n 9 40        40-44     total 19231  16232\n10 45        45-49     total 16463  15079\n# ℹ 62 more rows\n```\n\n\n:::\n:::\n\n\n# pyramids\n\nTo get a better sense of our population in 2021, we'll make 3 pyramids for the total by age group, a facet by nationality, and a per capita by nationality graph.\n\n## population by age group\n\nIn the grand scheme of things, men outnumber women in Brunei by around 11.4%. What I find particularly interesting is the odd bulge at around 20-45 for men. At this subset, men outnumbered women by an average of about 21.5%, compared to the overall difference per age group of around 4.6%.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# total population by age group\nage_group %>%\n  filter(type == \"total\") %>% \n  # melt for male and female\n  melt(value.name = \"total\",\n       variable.name = \"gender\") %>%\n  # plot\n  ggplot(aes(fill = gender, \n             x = lower_age, \n             y = ifelse(\n               test = gender == \"male\",\n               # flip the values to the negative\n               yes = -total,\n               no = total),\n             )) +\n         geom_col(alpha = 0.9) +\n  # flip the y-axis\n  coord_flip() +\n  scale_y_continuous(\n    labels = abs, # set as absolute to remove negative sign\n    limits = c(-25000, 25000) # set limits aesthetics\n    ) +\n  labs(\n    x = \"total\",\n    y = \"age group\",\n    title = \"population by age group\"\n  ) + # change color with brewer\n  scale_fill_brewer(palette = \"Set1\") +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](population_pyramid_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n\n## age groups by nationality\n\nThis is where we really see the reason why.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# total population by age group\nage_group %>%\n  #filter out total\n  filter(type != \"total\") %>%\n  # melt for male and female\n  melt(\n    value.name = \"total\",\n    variable.name = \"gender\") %>%\n  # plot\n  ggplot(aes(fill = gender, \n             x = lower_age, \n             y = ifelse(\n               test = gender == \"male\",\n               # flip the values to the negative\n               yes = -total,\n               no = total),\n             )) +\n         geom_col(alpha = 0.9) +\n  # flip the y-axis\n  coord_flip() +\n  scale_y_continuous(\n    labels = abs, # set as absolute to remove negative sign\n    # limits = c(-30000, 30000) # set limits aesthetics\n    ) +\n  labs(\n    x = \"total\",\n    y = \"age group\",\n    title = \"population by age group\"\n  ) + # change color with brewer\n  scale_fill_brewer(palette = \"Set1\") +\n  facet_wrap(~type) +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](population_pyramid_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n\nWe can see here that temporary residents make up quite a large proportion of the general population. In fact, overall, they constitute up to 34.4% across both genders. \n\n\n::: {.cell}\n\n```{.r .cell-code}\nage_group %>% \n  filter(type != \"total\") %>%\n  melt(value.name = \"total\",\n       variable.name = \"gender\") %>% \n  # filter(age_group %in% c(\"20-24\", \"25-29\", \"30-34\", \"35-39\", \"40-44\")) %>% \n  group_by(age_group, type) %>%\n  summarise(total = sum(total)) %>% \n  # pivot wider\n  pivot_wider(names_from = type, values_from = total) %>% \n  mutate(total = bruneian + permanent_resident + temporary_resident) %>% \n  # percentage of total\n  mutate(\n    bruneian = bruneian/total * 100,\n    permanent_resident = permanent_resident/total * 100,\n    temporary_resident = temporary_resident/total * 100) %>% \n  select(-total)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 18 × 4\n# Groups:   age_group [18]\n   age_group bruneian permanent_resident temporary_resident\n   <chr>        <dbl>              <dbl>              <dbl>\n 1 00-04         90.4               1.94               7.63\n 2 05-09         89.6               2.07               8.37\n 3 10-14         88.6               2.99               8.38\n 4 15-19         89.1               4.10               6.76\n 5 20-24         85.7               3.98              10.3 \n 6 25-29         77.1               3.73              19.2 \n 7 30-34         70.9               3.93              25.2 \n 8 35-39         64.0               5.02              31.0 \n 9 40-44         60.0               6.80              33.2 \n10 45-49         57.9               7.65              34.4 \n11 50-54         61.9               8.91              29.2 \n12 55-59         69.3              11.2               19.5 \n13 60-64         76.6              13.1               10.3 \n14 65-69         79.7              14.0                6.29\n15 70-74         81.3              13.9                4.78\n16 75-79         80.7              14.8                4.51\n17 80-84         80.5              15.5                4   \n18 85+           78.7              18.0                3.28\n```\n\n\n:::\n:::\n\nAmong men aged 20 to 49, the percentage of temporary residents can reach as high as 40% in certain age groups.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nage_group %>% \n  filter(type != \"total\") %>%\n  melt(value.name = \"total\",\n       variable.name = \"gender\") %>% \n  filter(age_group %in% c(\"20-24\", \n                          \"25-29\", \n                          \"30-34\", \n                          \"35-39\", \n                          \"40-44\", \n                          \"45-49\")) %>% \n  group_by(age_group, type, gender) %>%\n  filter(gender == \"male\") %>% \n  summarise(total = sum(total)) %>% \n  # pivot wider\n  pivot_wider(names_from = type, values_from = total) %>% \n  mutate(total = bruneian + permanent_resident + temporary_resident) %>% \n  # percentage of total\n  mutate(\n    bruneian = bruneian/total * 100,\n    permanent_resident = permanent_resident/total * 100,\n    temporary_resident = temporary_resident/total * 100) %>% \n  select(-total)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 × 5\n# Groups:   age_group [6]\n  age_group gender bruneian permanent_resident temporary_resident\n  <chr>     <fct>     <dbl>              <dbl>              <dbl>\n1 20-24     male       83.3               3.89               12.8\n2 25-29     male       71.4               3.44               25.1\n3 30-34     male       65.3               3.72               31.0\n4 35-39     male       58.0               3.97               38.0\n5 40-44     male       55.6               4.89               39.5\n6 45-49     male       54.2               5.67               40.1\n```\n\n\n:::\n:::\n\n## per capita by nationality\nFinal pyramids show per capita of the age group and gender. It is the most telling of the nation's overall population structure.\n\nWe can draw our own conclusions here on the implications on the Bruneian system.\n\n::: {.cell}\n\n```{.r .cell-code}\nage_group %>% \n  filter(type != \"total\") %>% \n  group_by(type) %>% \n  mutate(total_m = sum(male),\n         total_f = sum(female),\n         `per capita male` = (male/total_m) * 100,\n         `per capita female` = (female/total_f) * 100) %>% \n  select(lower_age, `per capita male`, `per capita female`) %>% \n  melt(variable.name = \"gender\",\n       value.name = \"total\") %>% \n  ggplot(aes(fill = gender, \n             x = lower_age, \n             y = ifelse(\n               test = gender == \"per capita male\",\n               # flip the values to the negative\n               yes = -total,\n               no = total),\n             )) +\n         geom_col(alpha = 0.9) +\n  # flip the y-axis\n  coord_flip() +\n  facet_wrap(~type) +\n  scale_y_continuous(\n    labels = abs, # set as absolute to remove negative sign\n    limits = c(-20, 20) # set limits aesthetics\n    ) +\n  labs(\n    x = \"total\",\n    y = \"age group\",\n    title = \"population by age group\"\n  ) + # change color with brewer\n  scale_fill_brewer(palette = \"Set1\") +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](population_pyramid_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n",
    "supporting": [
      "population_pyramid_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}